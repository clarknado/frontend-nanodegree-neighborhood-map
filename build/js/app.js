var yelpSearch=function(){var a=this;a.base="/v2/search?",a.term=ko.observable("food"),a.location=ko.observable(),a.cll=ko.observable(),a.bounds=ko.observable(),a.prop={term:["term",a.term],location:["location",a.location],cll:["cll",a.cll],bounds:["bounds",a.bounds]},a.url=ko.observable(),a.update=function(b,c,d){a.location(d.split(/ /).join("+")),a.cll(b.split(/[() ]/).join("")),a.bounds(c.split(/\), \(/).join("|").split(/[() ]/).join("")),a.url(a.base+a.urlGen())},a.urlGen=function(){var b=[];for(var c in a.prop)a.prop.hasOwnProperty(c)&&b.push(a.prop[c][0]+"="+a.prop[c][1]());return b.join("&")},a.ajax=function(a){$.ajax({url:"yelp",contentType:"json",success:function(a,b,c){console.log(a),console.log(b),console.log(c)}})},a.responseParse=function(a,b,c){console.log(a)},a.yelp=function(){a.ajax(a.responseParse)}},ViewModel=function(){var a=this;a.googleSearch=ko.observable(),a.geocoder=new google.maps.Geocoder,a.yelpSearch=new yelpSearch,a.init=function(b){b||(b=document.getElementById("map-canvas")),a.currentMap=new google.maps.Map(b);var c=new google.maps.LatLng(-34.397,150.644),d=new google.maps.LatLng(-34.64592382130048,147.9138974609375),e=new google.maps.LatLng(-34.14733356336124,153.3741025390625),f=new google.maps.LatLngBounds(d,e);a.updateMap(a.currentMap,c,f)},a.googleCode=function(){a.geocoder.geocode({address:a.googleSearch()},function(b,c){c==google.maps.GeocoderStatus.OK?(updates=b[0].geometry,a.yelpSearch.update(updates.location.toString(),updates.viewport.toString(),b[0].formatted_address),a.updateMap(a.currentMap,updates.location,updates.viewport)):a.errorReturn("geocoder")})},a.updateMap=function(b,c,d){google.maps.event.addListenerOnce(b,"idle",function(){a.yelpSearch.yelp()}),b.setCenter(c),b.fitBounds(d)},a.checkEnter=function(b,c){return 13===c.keyCode&&a.googleCode(),!0},a.errorReturn=function(a){console.log("geocoder"===a?a:a)},a.wikiResult=function(){var a=setTimeout(function(){$wikiElem.text("failed to get wikipedia resources")},8e3),b="http://en.wikipedia.org/w/api.php?format=json&action=query&list=search&srsearch="+address;$.ajax({url:b,dataType:"jsonp",success:function(b,c,d){var e=[];console.log(b),$.each(b.query.search,function(a,b){e.push('<li class=article><a href="http://en.wikipedia.org/wiki/'+b.title+'">'+b.title+"</a></li>")}),clearTimeout(a),$wikiElem.append(e.join(""))}})},google.maps.event.addDomListener(window,"load",a.init())};ko.applyBindings(new ViewModel);